<?xml version="1.0" encoding="UTF-8"?>
<!--
    Reachy Mini MJCF Model

    A MuJoCo model of the Reachy Mini robot for physics simulation.

    Kinematic Structure:
    - Base (body rotation: continuous 360°)
    - Head assembly (pitch, yaw, roll, z-lift)
    - Left antenna (-150° to +150°)
    - Right antenna (-150° to +150°)

    Joint Limits (from spec):
    - head_pitch: -45° to +35°
    - head_yaw: -60° to +60°
    - head_roll: -35° to +35°
    - head_z: 0mm to 50mm
    - body_rotation: -180° to +180° (continuous)
    - antenna_left/right: -150° to +150°
-->
<mujoco model="reachy_mini">
    <!-- Compiler settings -->
    <compiler angle="degree" coordinate="local" inertiafromgeom="true"/>

    <!-- Simulation options -->
    <option timestep="0.002" iterations="50" tolerance="1e-10" gravity="0 0 -9.81">
        <flag warmstart="enable"/>
    </option>

    <!-- Visual defaults -->
    <visual>
        <rgba haze="0.15 0.25 0.35 1"/>
        <quality shadowsize="2048"/>
        <map znear="0.01" zfar="50"/>
    </visual>

    <!-- Default properties -->
    <default>
        <joint armature="0.1" damping="1" limited="true"/>
        <geom condim="3" friction="0.8 0.02 0.01" margin="0.001"/>
        <motor ctrllimited="true" ctrlrange="-50 50"/>
        <position kp="100" kv="10"/>

        <!-- Robot body material -->
        <default class="robot_body">
            <geom rgba="0.2 0.2 0.25 1"/>
        </default>

        <!-- Head material -->
        <default class="robot_head">
            <geom rgba="0.85 0.85 0.9 1"/>
        </default>

        <!-- Antenna material -->
        <default class="antenna">
            <geom rgba="0.1 0.1 0.15 1"/>
        </default>

        <!-- Eye material -->
        <default class="eyes">
            <geom rgba="0.1 0.6 0.9 1"/>
        </default>
    </default>

    <!-- Assets -->
    <asset>
        <!-- Ground texture -->
        <texture name="grid" type="2d" builtin="checker" rgb1="0.1 0.2 0.3" rgb2="0.2 0.3 0.4" width="512" height="512"/>
        <material name="grid_mat" texture="grid" texrepeat="5 5" reflectance="0.1"/>

        <!-- Robot materials -->
        <material name="body_mat" rgba="0.2 0.2 0.25 1" specular="0.5" shininess="0.5"/>
        <material name="head_mat" rgba="0.85 0.85 0.9 1" specular="0.8" shininess="0.8"/>
        <material name="antenna_mat" rgba="0.1 0.1 0.15 1" specular="0.3"/>
        <material name="eye_mat" rgba="0.1 0.6 0.9 1" emission="0.3"/>
    </asset>

    <!-- World body -->
    <worldbody>
        <!-- Lighting -->
        <light name="spotlight" pos="0 -1 2" dir="0 1 -1" diffuse="0.8 0.8 0.8" specular="0.3 0.3 0.3"/>
        <light name="ambient" pos="0 0 3" dir="0 0 -1" diffuse="0.4 0.4 0.4" specular="0.1 0.1 0.1"/>

        <!-- Ground plane -->
        <geom name="floor" type="plane" size="5 5 0.1" material="grid_mat"/>

        <!-- Robot base (fixed to world or mobile) -->
        <body name="base" pos="0 0 0.15">
            <inertial pos="0 0 0" mass="2.0" diaginertia="0.01 0.01 0.01"/>
            <geom name="base_cylinder" type="cylinder" size="0.08 0.08" class="robot_body" material="body_mat"/>

            <!-- Body rotation joint (continuous) -->
            <joint name="body_rotation" type="hinge" axis="0 0 1" range="-180 180" damping="2"/>

            <body name="torso" pos="0 0 0.1">
                <inertial pos="0 0 0.05" mass="1.0" diaginertia="0.005 0.005 0.003"/>
                <geom name="torso_geom" type="capsule" fromto="0 0 0 0 0 0.15" size="0.06" class="robot_body" material="body_mat"/>

                <!-- Head Z-lift (vertical translation) -->
                <body name="head_lift" pos="0 0 0.15">
                    <joint name="head_z" type="slide" axis="0 0 1" range="0 0.05" damping="1"/>

                    <!-- Head yaw joint -->
                    <body name="head_yaw_link" pos="0 0 0.02">
                        <inertial pos="0 0 0" mass="0.1" diaginertia="0.0001 0.0001 0.0001"/>
                        <joint name="head_yaw" type="hinge" axis="0 0 1" range="-60 60" damping="0.5"/>

                        <!-- Head pitch joint -->
                        <body name="head_pitch_link" pos="0 0 0.02">
                            <inertial pos="0 0 0" mass="0.1" diaginertia="0.0001 0.0001 0.0001"/>
                            <joint name="head_pitch" type="hinge" axis="0 1 0" range="-45 35" damping="0.5"/>

                            <!-- Head roll joint -->
                            <body name="head_roll_link" pos="0 0 0">
                                <inertial pos="0 0 0.03" mass="0.3" diaginertia="0.001 0.001 0.0008"/>
                                <joint name="head_roll" type="hinge" axis="1 0 0" range="-35 35" damping="0.5"/>

                                <!-- Head geometry -->
                                <body name="head" pos="0 0 0.05">
                                    <inertial pos="0 0 0" mass="0.5" diaginertia="0.002 0.002 0.002"/>

                                    <!-- Main head sphere -->
                                    <geom name="head_main" type="sphere" size="0.07" pos="0 0 0" class="robot_head" material="head_mat"/>

                                    <!-- Face plate -->
                                    <geom name="face_plate" type="box" size="0.05 0.06 0.02" pos="0.05 0 0" class="robot_head" material="head_mat"/>

                                    <!-- Left eye -->
                                    <geom name="left_eye" type="sphere" size="0.015" pos="0.065 0.025 0.015" class="eyes" material="eye_mat"/>

                                    <!-- Right eye -->
                                    <geom name="right_eye" type="sphere" size="0.015" pos="0.065 -0.025 0.015" class="eyes" material="eye_mat"/>

                                    <!-- Camera (visual only, sensor defined separately) -->
                                    <geom name="camera_lens" type="cylinder" size="0.008 0.005" pos="0.07 0 -0.01" euler="0 90 0" rgba="0.1 0.1 0.1 1"/>

                                    <!-- Camera sensor -->
                                    <camera name="head_camera" pos="0.08 0 0" euler="0 90 0" fovy="90"/>

                                    <!-- IMU site for sensors -->
                                    <site name="head_imu_site" pos="0 0 0" size="0.01"/>

                                    <!-- Left Antenna -->
                                    <body name="antenna_left_base" pos="0 0.04 0.06">
                                        <inertial pos="0 0 0.03" mass="0.05" diaginertia="0.00001 0.00001 0.00001"/>
                                        <joint name="antenna_left" type="hinge" axis="0 1 0" range="-150 150" damping="0.1"/>
                                        <geom name="antenna_left_geom" type="capsule" fromto="0 0 0 0 0 0.08" size="0.005" class="antenna" material="antenna_mat"/>
                                        <geom name="antenna_left_tip" type="sphere" size="0.008" pos="0 0 0.085" class="antenna" material="antenna_mat"/>
                                    </body>

                                    <!-- Right Antenna -->
                                    <body name="antenna_right_base" pos="0 -0.04 0.06">
                                        <inertial pos="0 0 0.03" mass="0.05" diaginertia="0.00001 0.00001 0.00001"/>
                                        <joint name="antenna_right" type="hinge" axis="0 1 0" range="-150 150" damping="0.1"/>
                                        <geom name="antenna_right_geom" type="capsule" fromto="0 0 0 0 0 0.08" size="0.005" class="antenna" material="antenna_mat"/>
                                        <geom name="antenna_right_tip" type="sphere" size="0.008" pos="0 0 0.085" class="antenna" material="antenna_mat"/>
                                    </body>
                                </body>
                            </body>
                        </body>
                    </body>
                </body>
            </body>
        </body>
    </worldbody>

    <!-- Actuators -->
    <actuator>
        <!-- Position-controlled actuators for each joint -->
        <position name="body_rotation_actuator" joint="body_rotation" kp="200" kv="20" ctrlrange="-180 180"/>
        <position name="head_z_actuator" joint="head_z" kp="500" kv="50" ctrlrange="0 0.05"/>
        <position name="head_yaw_actuator" joint="head_yaw" kp="100" kv="10" ctrlrange="-60 60"/>
        <position name="head_pitch_actuator" joint="head_pitch" kp="100" kv="10" ctrlrange="-45 35"/>
        <position name="head_roll_actuator" joint="head_roll" kp="100" kv="10" ctrlrange="-35 35"/>
        <position name="antenna_left_actuator" joint="antenna_left" kp="50" kv="5" ctrlrange="-150 150"/>
        <position name="antenna_right_actuator" joint="antenna_right" kp="50" kv="5" ctrlrange="-150 150"/>
    </actuator>

    <!-- Sensors -->
    <sensor>
        <!-- Joint position sensors -->
        <jointpos name="body_rotation_pos" joint="body_rotation"/>
        <jointpos name="head_z_pos" joint="head_z"/>
        <jointpos name="head_yaw_pos" joint="head_yaw"/>
        <jointpos name="head_pitch_pos" joint="head_pitch"/>
        <jointpos name="head_roll_pos" joint="head_roll"/>
        <jointpos name="antenna_left_pos" joint="antenna_left"/>
        <jointpos name="antenna_right_pos" joint="antenna_right"/>

        <!-- Joint velocity sensors -->
        <jointvel name="body_rotation_vel" joint="body_rotation"/>
        <jointvel name="head_z_vel" joint="head_z"/>
        <jointvel name="head_yaw_vel" joint="head_yaw"/>
        <jointvel name="head_pitch_vel" joint="head_pitch"/>
        <jointvel name="head_roll_vel" joint="head_roll"/>
        <jointvel name="antenna_left_vel" joint="antenna_left"/>
        <jointvel name="antenna_right_vel" joint="antenna_right"/>

        <!-- IMU sensors (attached to head) -->
        <accelerometer name="head_accel" site="head_imu_site"/>
        <gyro name="head_gyro" site="head_imu_site"/>

        <!-- Camera frame sensor (for synchronization) -->
        <framepos name="camera_pos" objtype="camera" objname="head_camera"/>
        <framequat name="camera_quat" objtype="camera" objname="head_camera"/>
    </sensor>

    <!-- Keyframes for common poses -->
    <keyframe>
        <key name="home" qpos="0 0 0 0 0 0 0"/>
        <key name="look_up" qpos="0 0 0 -30 0 0 0"/>
        <key name="look_down" qpos="0 0 0 25 0 0 0"/>
        <key name="look_left" qpos="0 0 45 0 0 0 0"/>
        <key name="look_right" qpos="0 0 -45 0 0 0 0"/>
        <key name="antennas_up" qpos="0 0 0 0 0 90 90"/>
        <key name="antennas_down" qpos="0 0 0 0 0 -90 -90"/>
    </keyframe>
</mujoco>
